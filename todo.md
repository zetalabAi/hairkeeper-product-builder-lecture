# 머리보존 AI - TODO

## Phase 1: 프로젝트 초기화 및 요구사항 분석
- [x] 프로젝트 초기화
- [x] 요구사항 문서 분석
- [x] 디자인 계획 수립
- [x] TODO 리스트 작성

## Phase 2: 데이터베이스 스키마 및 백엔드 API 설계
- [x] 사용자 테이블 설계 (구독 상태 포함)
- [x] 작업 히스토리 테이블 설계
- [x] 얼굴 풀 테이블 설계
- [x] 이미지 합성 API 엔드포인트 설계
- [x] 결제/구독 API 엔드포인트 설계
- [x] 데이터베이스 마이그레이션 실행

## Phase 3: 앱 브랜딩 및 로고 생성
- [x] 앱 로고 생성 (AI 이미지 생성)
- [x] 앱 아이콘 설정 (icon.png)
- [x] 스플래시 스크린 아이콘 설정
- [x] Android 아이콘 설정
- [x] app.config.ts 브랜딩 정보 업데이트

## Phase 4: UI/UX 구현 - 온보딩 및 인증
- [x] 온보딩 화면 구현 (3개 슬라이드)
- [x] 로그인 화면 구현
- [x] 소셜 로그인 통합 (Google/Naver/Kakao)
- [x] 인증 상태 관리 (useAuth)
- [x] 온보딩 완료 플래그 저장 (AsyncStorage)

## Phase 5: UI/UX 구현 - 메인 플로우
- [x] 홈 화면 구현
- [x] 사진 선택 기능 (카메라/앨범)
- [x] 사진 편집 화면 (국적/성별/스타일 선택)
- [x] 얼굴 선택 화면 (그리드 레이아웃)
- [x] 결과 확인 화면 (Before/After 토글)
- [x] 저장 및 공유 기능
- [ ] 설정 화면

## Phase 6: AI 이미지 합성 엔진 통합
- [ ] 얼굴/헤어 세그멘테이션 모듈 통합
- [ ] 서버 API 연동 (이미지 업로드)
- [ ] AI 합성 요청 및 결과 수신
- [ ] 로딩 상태 UI 구현
- [ ] 오류 처리 및 재시도 로직

## Phase 7: 결제 및 구독 시스템
- [ ] 구독 상태 UI 표시
- [ ] 프리미엄 구독 화면 구현
- [ ] 인앱 결제 통합 (Google Play/App Store)
- [ ] 워터마크 로직 구현 (무료 사용자)
- [ ] 광고 통합 (AdMob)

## Phase 8: 테스트 및 최종 검증
- [ ] 전체 사용자 플로우 테스트
- [ ] 오류 처리 검증
- [ ] 성능 최적화 (로딩 시간)
- [ ] 접근성 검증 (VoiceOver/TalkBack)
- [ ] 다크모드 검증
- [ ] 최종 체크포인트 생성

## Phase 9: 결과물 전달
- [ ] 사용자에게 결과 전달
- [ ] 배포 가이드 제공

## 사용자 요청: 로그인 우회 (테스트용)
- [x] 홈 화면에서 인증 체크 제거
- [x] 온보딩 화면에서 바로 홈으로 이동
- [x] 로그인 없이 모든 기능 사용 가능하도록 수정

## 사용자 요청: 기존 디자인 영상 기반 UI/UX 수정
- [x] 색상 테마 변경 (핑크 → 보라색 #8B7FF5, 라이트 → 다크)
- [x] 홈 화면 리디자인 (원형 버튼 → 둥근 사각형 + 아이콘)
- [x] 스타일 선택 화면 리디자인 (아이콘 카드 그리드)
- [x] 결과 화면 리디자인 (토글 → 좌우 슬라이더)
- [x] 전체 레이아웃 조정 (더 큰 버튼, 넓은 여백)

## 사용자 요청: 이모지 제거 및 네비게이션 재설계
- [x] 유사 앱 시장 분석 (사진 편집, AI 얼굴 교체 앱)
- [x] 네비게이션 패턴 조사 및 문서화
- [x] 모든 이모지 제거 및 SVG/아이콘 대체
- [x] 상단 네비게이션 바 재설계 (뒤로가기, 제목, 액션 버튼)
- [x] 하단 탭바 재설계 (홈, 히스토리, 설정, 프로필)
- [x] 각 버튼의 기능과 목적 명확화

## 사용자 요청: iOS 원리 기반 독자적 UI 재설계
- [x] 디자인 철학 문서 작성 (iOS 이해 + 독자적 해석)
- [x] 색상 시스템 재설계 (저채도 브랜드 컴러, iOS system color 금지)
- [x] 버튼 컴포넌트 재설계 (soft rounded, border 금지, depth 표현)
- [x] 사진 선택 화면 재설계 (카드형 버튼, Action Sheet 금지)
- [x] 스타일 선택 화면 재설계 (segmented 느낌, iOS control과 구분)
- [x] CTA 버튼 재설계 (하단 고정, 브랜드 중심)
- [x] 전체 화면 일관성 적용
- [x] Press 애니메이션 (opacity + 1px 이동만, bounce 금지)

## 사용자 요청: 내비게이션 구조 전면 변경
- [x] 하단 내비게이션 바 완전 제거 (모든 화면)
- [x] 메인 화면 상단: 좌측 비움, 우측 프로필 버튼 추가
- [x] 서브 화면 상단: 좌측 뒤로가기, 우측 홈 버튼 추가
- [x] 뒤로가기 버튼: 메인 화면 도달 시 자동 숨김/비활성화
- [x] 설정 페이지: 세련된 리스트 UI로 재설계
- [x] 프로필 페이지: 구독/결제 관리 포함, 리스트 UI로 재설계
- [x] 기능 로직 보존: UI만 변경, 데이터 흐름/비즈니스 로직 수정 금지

## 사용자 요청: 개발 단계 데모 계정 자동 로그인
- [x] AsyncStorage를 사용한 로그인 상태 관리
- [x] 로그인 버튼 클릭 시 데모 계정 정보 저장
- [x] 프로필 페이지에서 로그인 상태 확인 및 사용자 정보 표시
- [x] 로그아웃 기능 구현

## 사용자 요청: 실제 AI 이미지 합성 기능 구현
- [x] 서버 README 및 내장 LLM 기능 분석
- [x] 이미지 분석 API 구현 (analyzeFace - 얼굴 감지, 특징 추출)
- [x] 세그먼테이션 API 구현 (LLM vision으로 얼굴/머리/배경 분석)
- [x] 얼굴 합성 API 구현 (synthesizeFace - MVP 버전)
- [x] 클라이언트에서 API 호출 및 결과 표시
- [x] 로딩 화면 추가 (진행률 표시)

## 사용자 요청: 한국인 전용으로 수정
- [x] 스타일 선택 페이지에서 "서양인", "동남아시아인" 제거
- [x] "한국인 - 남성", "한국인 - 여성"만 남기기
- [x] 얼굴 선택 화면 더미 이미지를 AI 생성 한국인 얼굴로 교체
- [x] 합성 API 수정: 얼굴 형태 유지, 이목구비만 한국 미의 기준에 맞춰 수정
- [x] 합성 시 실존하지 않는 AI 생성 얼굴 사용

## 사용자 요청: 실제 이미지 생성 API 통합, 히스토리, 온보딩 리디자인
- [x] Replicate Face Swap API 조사 및 분석
- [x] Replicate API 키 설정 및 통합
- [x] Face Swap 모델 구현 (실제 얼굴 교체)
- [x] 히스토리 화면 구현 (카드 그리드 레이아웃)
- [ ] 히스토리 데이터베이스 연동 (추후 구현)
- [x] 온보딩 화면 리디자인 (보라색 테마, soft rounded 버튼)

## 사용자 보고: Face Swap API 오류
- [x] 서버 로그 확인 및 오류 원인 분석
- [x] Replicate API 호출 부분 디버깅
- [x] 이미지 URL 형식 확인 및 수정 (로컬 이미지를 S3에 업로드)
- [x] 얼굴 이미지 12개를 S3에 업로드하고 URL 매핑
- [x] 이미지 업로드 API 추가 (uploadImage)
- [x] 오류 수정 후 재테스트

## 사용자 보고: Face Swap API 여전히 실패
- [x] Replicate API 키 확인 (결제 필요 여부) - $10 결제 완료
- [x] 서버 로그에서 실제 에러 메시지 확인 - 402 Payment Required
- [x] 테스트 이미지로 직접 API 호출 테스트 - 성공
- [x] 이미지 URL 접근 가능 여부 확인 - S3 URL 정상
- [x] Replicate API 파라미터 검증 - 정상
- [x] 실제 원인 찾아 수정 - 잘못된 API 키 사용, 새 키로 교체 완료

## 사용자 보고: 실제 앱에서 여전히 Face Swap 실패
- [x] 실시간 서버 로그에서 정확한 에러 메시지 확인
- [x] 클라이언트에서 전송하는 파라미터 검증
- [x] 이미지 업로드 과정 확인
- [x] Replicate API 호출 파라미터 확인
- [x] 실제 원인 찾아 수정 - 웹 환경에서 expo-file-system 사용 불가
- [x] 실제 앱에서 재테스트 - Expo Go 앱에서 정상 작동 확인

## 사용자 요청: 히스토리 DB 연동 및 기능 개선
- [x] Projects 테이블에 작업 기록 저장 (Face Swap 완료 후)
- [x] 히스토리 화면에서 실제 DB 데이터 조회
- [x] 결과 화면에 이미지 저장 버튼 추가
- [x] expo-media-library로 갤러리 저장 구현
- [x] 로딩 진행률을 단계별로 표시 (업로드 30%, Face Swap 70%)
- [x] 실시간 진행률 업데이트 구현

## 사용자 요청: 얼굴 합성 기능 완벽화 (기술 방법 조사 중)
- [ ] 얼굴형 분석 및 유사 얼굴 추천 기술 조사
- [ ] 머리카락 경계선 보존 기술 조사
- [ ] 완벽한 구현 방법 브리핑
- [ ] 기술 방법 확정 후 구현

## 사용자 요청: 이미지/영상 합성 비즈니스 모델 설계
- [ ] Dzine AI 가격 정보 조사 (이미지 합성, 영상 생성)
- [ ] Kling AI 가격 정보 조사 (이미지 합성, 영상 생성)
- [ ] 비용 구조 분석 (API 호출당 비용)
- [ ] 구독 요금제 설계 (무료, 프로, 프로플러스)
- [ ] 크레딧 시스템 설계 (충전, 소모, 추가 구매)
- [ ] 마진 계산 및 수익성 분석
- [ ] 비즈니스 모델 기획서 작성

## ChatGPT 분석 검증 및 비즈니스 모델 수정
- [x] Kling 이미지 합성 성공률 및 실패율 데이터 조사 - 20-80% 실패율 확인
- [x] Dzine vs Kling 실제 사용자 리뷰 및 사례 분석 - Dzine이 안정적
- [x] 재시도 비용 및 실제 마진 재계산 - 프로플러스 72% 마진
- [x] 비즈니스 모델 수정 (Dzine + Kling 멀티 API 전략)
- [x] 최종 권장사항 작성

## Dzine + Kling 멀티 API 전략 구현
### Phase 1: Dzine AI 통합 (이미지 합성)
- [ ] Dzine AI API 키 발급 및 환경 변수 설정
- [ ] Dzine AI 이미지 합성 API 통합
- [ ] Character Consistency 기능 테스트
- [ ] 9명의 얼굴 세트 생성 (다각도: 정면, 측면, 상하)

### Phase 2: Kling AI 통합 (영상 생성)
- [ ] Kling AI API 키 발급 및 환경 변수 설정
- [ ] Kling AI 영상 생성 API 통합
- [ ] 5초 릴스 영상 생성 테스트
- [ ] Elements 기능 테스트

### Phase 3: 멀티 API 시스템 구축
- [ ] API 라우팅 로직 구현 (이미지 → Dzine, 영상 → Kling)
- [ ] 장애 시 자동 전환 로직 (백업 API)
- [ ] 재시도 제한 정책 구현 (무료 사용자)

### Phase 4: 크레딧 시스템 구현
- [ ] 크레딧 충전/소모 로직
- [ ] 구독 플랜별 크레딧 할당
- [ ] 추가 크레딧 구매 기능
- [ ] 워터마크 로직 (무료 플랜)

### Phase 5: 결제 시스템 통합
- [ ] Stripe/Toss Payments 통합
- [ ] 월 구독 자동 결제
- [ ] 크레딧 추가 구매 결제
- [ ] 다운그레이드 기능

### Phase 6: 테스트 및 최종 전달
- [ ] 전체 플로우 테스트
- [ ] API 비용 모니터링
- [ ] 사용자 피드백 수집
- [ ] 공식 출시
